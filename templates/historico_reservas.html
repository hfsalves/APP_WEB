{% extends "base.html" %}
{% set page_title = "Histórico de Tarefas" %}
{% set page_name = "Histórico de Tarefas" %}

{% block title %}Histórico de Tarefas{% endblock %}

{% block content %}
<div class="container-fluid py-3">
  <div class="d-flex align-items-center gap-2 flex-wrap mb-3">
    <button class="btn btn-sm btn-outline-secondary" id="histPrev"><i class="fa-solid fa-chevron-left"></i></button>
    <input type="date" class="form-control form-control-sm" id="histDate" style="max-width: 160px;">
    <button class="btn btn-sm btn-outline-secondary" id="histNext"><i class="fa-solid fa-chevron-right"></i></button>
    {% if can_filter %}
    <select class="form-select form-select-sm" id="histUser" style="max-width: 220px;">
      <option value="">Utilizador...</option>
    </select>
    {% endif %}
    <div class="text-muted small ms-2" id="histInfo"></div>
  </div>

  <div id="histGrid" class="tempos-grid">
    <div class="text-muted">A carregar...</div>
  </div>
</div>

<style>
  .tempos-grid{
    display:flex;
    flex-direction:column;
    gap: 12px;
  }
  @media (min-width: 992px){
    .tempos-grid{
      max-width: 500px;
      align-items: stretch;
    }
  }
  .tcard{
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:16px;
    box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
    overflow:hidden;
    display:flex;
    flex-direction:column;
    min-height: 130px;
  }
  .tcard-head{
    padding: 12px 14px 10px 14px;
    background: linear-gradient(135deg, rgba(14,165,233,.10) 0%, rgba(37,99,235,.10) 100%);
    border-bottom: 1px solid rgba(148, 163, 184, 0.35);
  }
  .tcard-title{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }
  .tcard-alo{
    font-weight: 800;
    color:#0f172a;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .tcard-time{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-weight: 800;
    color:#1d4ed8;
    background: rgba(29,78,216,.12);
    border: 1px solid rgba(29,78,216,.18);
    border-radius: 999px;
    padding: 2px 8px;
    white-space: nowrap;
  }
  .tcard-body{
    padding: 12px 14px 0 14px;
    flex: 1 1 auto;
  }
  .tcard-sub{
    color:#334155;
    font-weight: 600;
    font-size: 12px;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }
  .tbadge.real{
    background:#f1f5f9;
    border-color:#e2e8f0;
    color:#0f172a;
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-weight: 700;
  }
  .tbadge.real.good{
    background:#dcfce7;
    border-color:#bbf7d0;
    color:#166534;
  }
  .tbadge.real.bad{
    background:#fee2e2;
    border-color:#fecaca;
    color:#991b1b;
  }
  .tcard-meta{
    margin-top: 8px;
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    align-items:center;
  }
  .tbadge{
    display:inline-flex;
    align-items:center;
    gap:.35rem;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 12px;
    border:1px solid #e5e7eb;
    background:#f8fafc;
    color:#0f172a;
    font-weight:700;
  }
  .tbadge.done{ background:#dcfce7; border-color:#bbf7d0; color:#166534; }
  .tbadge.run{ background:#fffbeb; border-color:#fde68a; color:#92400e; }
  .tbadge.todo{ background:#eff6ff; border-color:#bfdbfe; color:#1d4ed8; }

  .tcard-anexos{
    padding: 8px 14px 14px 14px;
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    align-items:center;
  }
  .tcard-gap{
    background: #fee2e2;
    border: 1px dashed #fecaca;
    color: #991b1b;
    border-radius: 12px;
    padding: 8px 12px;
    font-size: 12px;
    font-weight: 700;
    text-align:center;
  }
  .tcard-gap.good{
    background:#dcfce7;
    border-color:#bbf7d0;
    color:#166534;
  }
  .tcard-gap.bad{
    background:#fee2e2;
    border-color:#fecaca;
    color:#991b1b;
  }
  .anx{
    position:relative;
    width:52px;
    height:52px;
    border-radius: 12px;
    overflow:hidden;
    border:1px solid rgba(148, 163, 184, 0.35);
    background:#fff;
  }
  .anx img, .anx video{
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .anx-empty{
    color:#64748b;
    font-size:12px;
    font-weight:700;
    padding: 0 14px 14px 14px;
  }
</style>

<script>
  window.currentLogin = "{{ current_login|e }}";
</script>
<script src="{{ url_for('static', filename='js/historico_reservas.js') }}?v={{ static_version }}"></script>
{% endblock %}
