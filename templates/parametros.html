{% extends "base.html" %}

{% set page_title = "Parâmetros" %}
{% set page_name = "Parâmetros" %}
{% block title %}Parâmetros{% endblock %}

{% block content %}
<div class="container-fluid py-3 para-page">
  <div class="d-flex flex-wrap align-items-center gap-2 mb-3 para-toolbar">
    <button class="btn btn-sm btn-outline-secondary" id="paraReload"><i class="fa-solid fa-rotate"></i> Atualizar</button>
    <div class="para-search">
      <input type="text" class="form-control form-control-sm" id="paraSearch" placeholder="Pesquisar parâmetro..." style="max-width:280px;">
      <button type="button" class="btn btn-sm btn-light para-clear" id="paraClear" aria-label="Limpar">×</button>
    </div>
    <div class="ms-auto d-flex gap-2">
      <button class="btn btn-sm btn-outline-primary" id="paraNewBtn"><i class="fa-solid fa-plus"></i> Novo parâmetro</button>
      <button class="btn btn-sm btn-primary" id="paraSave"><i class="fa-solid fa-floppy-disk"></i> Gravar</button>
    </div>
  </div>

  <div class="card shadow-sm para-card">
    <div class="card-body p-0 para-body">
      <div class="table-responsive para-grid-wrap">
        <table class="table table-sm mb-0 para-table">
          <colgroup>
            <col class="para-col-param">
            <col class="para-col-valor">
            <col class="para-col-codigo">
          </colgroup>
          <thead class="table-light">
            <tr>
              <th>Parâmetro</th>
              <th>Valor</th>
              <th>Código</th>
            </tr>
          </thead>
          <tbody id="paraBody">
            <tr><td colspan="3" class="text-muted p-3">A carregar...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="paraNewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Novo parâmetro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <div class="row g-2">
          <div class="col-12">
            <label class="form-label">Grupo</label>
            <div class="d-flex gap-2">
              <select class="form-select" id="newGrupo"></select>
              <button type="button" class="btn btn-outline-secondary" id="newGrupoBtn" title="Novo grupo"><i class="fa-solid fa-plus"></i></button>
            </div>
          </div>
          <div class="col-12">
            <label class="form-label">Parâmetro</label>
            <input class="form-control" id="newParametro" maxlength="50">
          </div>
          <div class="col-12">
            <label class="form-label">Descrição</label>
            <input class="form-control" id="newDescricao" maxlength="100">
          </div>
          <div class="col-4">
            <label class="form-label">Tipo</label>
            <select class="form-select" id="newTipo">
              <option value="C">C</option>
              <option value="N">N</option>
              <option value="D">D</option>
              <option value="L">L</option>
            </select>
          </div>
          <div class="col-8">
            <label class="form-label">Valor inicial</label>
            <input class="form-control" id="newValor">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="newParaSave">Criar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="paraEditModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Editar parâmetro</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="editParastamp">
        <div class="row g-2">
          <div class="col-12">
            <label class="form-label">Código</label>
            <input class="form-control" id="editParametro" maxlength="50">
          </div>
          <div class="col-12">
            <label class="form-label">Parâmetro</label>
            <input class="form-control" id="editDescricao" maxlength="100">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-danger me-auto" id="editParaDelete"><i class="fa-solid fa-trash-can"></i> Eliminar</button>
        <button type="button" class="btn btn-cancel" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="editParaSave">Gravar</button>
      </div>
    </div>
  </div>
</div>

<style>
  .para-page{
    height: calc(100vh - 120px);
    display:flex;
    flex-direction:column;
    gap:.35rem;
  }
  .para-toolbar{
    background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
    border: 1px solid #e2e8f0;
    border-radius: 12px;
    padding: .55rem .65rem;
    box-shadow: 0 6px 18px rgba(15, 23, 42, 0.05);
  }
  .para-card{
    flex:1 1 auto;
    overflow:hidden;
    border-radius: 14px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 12px 28px rgba(15, 23, 42, 0.07);
    background:#fff;
  }
  .para-body{ height:100%; }
  .para-grid-wrap{
    max-height:100%;
    overflow:auto;
    scrollbar-width: thin;
    scrollbar-color: #cbd5e1 transparent;
  }
  .para-grid-wrap::-webkit-scrollbar{ width:10px; height:10px; }
  .para-grid-wrap::-webkit-scrollbar-thumb{ background:#cbd5e1; border-radius:10px; }
  .para-grid-wrap::-webkit-scrollbar-track{ background:transparent; }
  .para-search{ position:relative; display:inline-flex; align-items:center; }
  .para-search input{ padding-right: 28px; }
  .para-clear{
    position:absolute; right:4px; top:50%; transform:translateY(-50%);
    border:none; width:22px; height:22px; border-radius:50%; line-height:18px; padding:0;
    color:#64748b; background:#f1f5f9;
  }
  .para-table{ border-collapse: separate; border-spacing:0; min-width:900px; font-size:12.5px; }
  .para-col-param{ width: 30%; min-width: 240px; }
  .para-col-valor{ width: 54%; min-width: 360px; }
  .para-col-codigo{ width: 10%; min-width: 110px; }
  .para-table thead th{
    position: sticky; top:0; z-index:2; background:linear-gradient(180deg,#fff,#f8fafc);
    border-bottom:1px solid rgba(148,163,184,.35); font-size:11px; text-transform:uppercase; letter-spacing:.05em; color:#334155;
    font-weight:800; padding:.55rem .75rem;
  }
  .para-table tbody td{
    padding:.5rem .75rem;
    border-bottom:1px solid #edf2f7;
    vertical-align:middle;
    background:#fff;
  }
  .para-table tbody tr:nth-child(even):not(.para-group-row) td{ background:#fcfdff; }
  .para-table tbody tr:not(.para-group-row):hover td{ background:#f1f5f9; }
  .para-table thead th:first-child,
  .para-table tbody td:first-child{ text-align:left !important; }
  .para-table tbody tr:not(.para-group-row) td:first-child{ padding-left: 3.2rem; }
  .para-table td.para-codigo{ font-weight: 700; font-style: italic; }
  .para-table td.para-codigo{ cursor:pointer; color:#1d4ed8; }
  .para-group-row td{
    background: linear-gradient(180deg, #eef4ff 0%, #e6f0ff 100%) !important;
    font-weight:700;
    text-align:left !important;
    border-top:1px solid #d8e4ff;
    border-bottom:1px solid #d8e4ff;
  }
  .para-group-toggle{ width:18px; height:18px; line-height:14px; padding:0; margin-right:6px; border-radius:4px; border:1px solid #93c5fd; background:#eff6ff; color:#1d4ed8; font-weight:800; font-size:12px; }
</style>

<script src="{{ url_for('static', filename='js/parametros.js') }}?v={{ static_version }}"></script>
{% endblock %}
