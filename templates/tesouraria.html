{% extends "base.html" %}
{% set page_title = "Tesouraria" %}
{% set page_name = "Tesouraria" %}
{% block title %}Tesouraria{% endblock %}

{% block content %}
<div class="widget widget-calendar nd-cal mb-4">
  <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
    <div class="btn-group" role="group" aria-label="Tipos de vista">
      <button type="button" class="btn btn-outline-primary active" id="viewCalendarBtn">
        <i class="fa-regular fa-calendar"></i> Calendário
      </button>
      <button type="button" class="btn btn-outline-primary" id="viewAgendaBtn">
        <i class="fa-solid fa-list"></i> Agenda
      </button>
    </div>
    <div class="d-flex align-items-center gap-2">
      <button id="prev-month" class="btn btn-link text-decoration-none" title="Mês anterior">&larr;</button>
      <h3 id="month-year" class="m-0"></h3>
      <button id="next-month" class="btn btn-link text-decoration-none" title="Mês seguinte">&rarr;</button>
    </div>
    <div class="d-flex align-items-center gap-2">
      <label class="form-label mb-0 small" for="accountFilter">Conta</label>
      <select id="accountFilter" class="form-select form-select-sm" style="min-width:180px">
        <option value="">Todas</option>
      </select>
    </div>
  </div>

  <div id="calendarView" class="widget-body px-4 pb-4">
    <div class="table-responsive">
      <table class="table calendar-table mb-0">
        <thead class="table-light">
        <tr>
          <th>Segunda</th>
          <th>Terça</th>
          <th>Quarta</th>
          <th>Quinta</th>
          <th>Sexta</th>
          <th>Sábado</th>
          <th>Domingo</th>
        </tr>
        </thead>
        <tbody id="calendar-body"></tbody>
      </table>
    </div>
  </div>

  <div id="agendaView" class="widget-body px-4 pb-4" style="display:none;">
    <div id="agendaList" class="list-group list-group-flush"></div>
  </div>
</div>

<!-- Modal detalhe Entradas/Saídas (BA) -->
<div class="modal fade" id="baDetailModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="baDetailTitle">Detalhe</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body">
        <div class="table-responsive rounded-3 border">
          <table class="table table-sm mb-0" id="baDetailTable">
            <thead class="table-light">
              <tr>
                <th>Documento</th>
                <th>Descrição</th>
                <th class="text-end">Valor</th>
              </tr>
            </thead>
            <tbody id="baDetailBody">
              <tr><td colspan="3" class="text-center text-muted">Selecione um dia.</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer d-flex justify-content-between">
        <div class="fw-semibold" id="baDetailTotal">Total: --</div>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<div class="mt-2 small">
  <span class="cash-card in me-2">Entradas</span>
  <span class="cash-card out me-2">Saídas</span>
  <span class="cash-card prev me-2">Previsões</span>
  <span class="badge-mov badge-saldo" style="width:auto">Saldo</span>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<style>
  .calendar-table { border-collapse: separate; border-spacing: 0; }
  .calendar-table td { height: 110px; vertical-align: top; }
  .calendar-table thead th { border-bottom:1px solid #e5e7eb; }
  .calendar-table thead th, .calendar-table tbody td { border-right: 1px solid #e5e7eb; }
  .calendar-table thead th:first-child, .calendar-table tbody td:first-child { border-left: 1px solid #e5e7eb; }
  .calendar-table thead th:last-child, .calendar-table tbody td:last-child { border-right: 0; }
  .calendar-table tbody td:first-child { vertical-align: top; }
  .day-num { font-size:.85rem; color:#6b7280; line-height:1; }
  /* alinhar cards (conteúdo) à direita dentro da célula */
  .day-cell .day-cards { align-items: flex-end; text-align: right; }
  .day-cell .day-cards .cash-cards { justify-content: flex-end; }
  .badge-mov { display:inline-flex; align-items:center; gap:.35rem; padding:2px 6px; border-radius:8px; font-size:.78rem; color:#0f172a; justify-content:flex-end; width:auto; text-align:right; white-space:nowrap; }
  .badge-ent { background:#1d4ed8; color:#fff; } /* azul sólido */
  .badge-sai { background:#16a34a; color:#fff; } /* verde sólido (gestão) */
  .badge-saldo { background:#374151; color:#fff; font-weight:700; }
  .day-cell.weekend { background-color:#f9fafb; }
  .day-cell.today { outline:2px solid #60a5fa; outline-offset:-2px; }
  #agendaList .list-group-item { display:flex; justify-content:space-between; align-items:center; }
  #agendaList .list-group-item.weekend { background:#f9fafb; }
  #agendaList .mov-labels { display:flex; gap:.35rem; align-items:center; flex-wrap:nowrap; justify-content:flex-end; overflow-x:auto; }
  .cash-card {
    display: inline-flex;
    align-items: center;
    gap: .4rem;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    font-weight: 700;
    font-size: .78rem;
    line-height: 1.4;
    white-space: nowrap;
  }
  button.cash-card { cursor: pointer; }
  button.cash-card:focus { outline: 2px solid #94a3b8; outline-offset: 2px; }
  button.cash-card { box-shadow: none; }
  .cash-card.in { background: #dcfce7; color: #166534; border-color: #bbf7d0; }
  .cash-card.out { background: #fee2e2; color: #991b1b; border-color: #fecaca; }
  .cash-card.prev { background: #dbeafe; color: #1d4ed8; border-color: #bfdbfe; }
  .cash-cards { display:flex; gap:.35rem; flex-wrap:wrap; }
  .cash-cards-vertical { flex-direction: column; flex-wrap: nowrap; align-items: flex-end; }
</style>
<script src="{{ url_for('static', filename='js/tesouraria.js') }}"></script>
{% endblock %}
